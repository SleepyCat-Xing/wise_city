<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>违章建筑智能检测系统 - 功能演示</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2rem;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .feature-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .feature-card .icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .test-button {
            background: linear-gradient(45deg, #3498db, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .result-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .result-area h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .result-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            min-height: 100px;
            border-left: 4px solid #3498db;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            background: #f8f9fa;
        }

        .upload-area.dragover {
            border-color: #2ecc71;
            background: #e8f5e8;
        }

        .file-input {
            margin: 10px 0;
        }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .api-endpoint {
            background: #2c3e50;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏗️ 违章建筑智能检测系统</h1>
            <p>基于多模态AI的智能检测与管理平台 - 功能演示</p>
        </div>

        <div class="feature-grid">
            <!-- 系统状态检查 -->
            <div class="feature-card">
                <h3><span class="icon">🔍</span>系统状态检查</h3>
                <p>检查系统健康状态和各服务运行情况</p>
                <button class="test-button" onclick="checkSystemHealth()">检查系统状态</button>
                <button class="test-button" onclick="getModelInfo()">获取模型信息</button>
                <div class="result-area" id="system-result" style="display:none;">
                    <h4>检查结果:</h4>
                    <div class="result-content" id="system-content"></div>
                </div>
            </div>

            <!-- 文件管理功能 -->
            <div class="feature-card">
                <h3><span class="icon">📁</span>文件管理功能</h3>
                <p>上传图像文件、查看存储统计、管理文件</p>
                
                <div class="upload-area" id="uploadArea">
                    <p>拖拽图像文件到此处或点击选择</p>
                    <input type="file" id="fileInput" class="file-input" accept="image/*" style="display:none;">
                    <button class="test-button" onclick="document.getElementById('fileInput').click()">选择文件</button>
                </div>
                
                <button class="test-button" onclick="uploadFile()">上传文件</button>
                <button class="test-button" onclick="getFileStats()">存储统计</button>
                <button class="test-button" onclick="listFiles()">文件列表</button>
                
                <div class="status" id="upload-status"></div>
                <div class="result-area" id="file-result" style="display:none;">
                    <h4>操作结果:</h4>
                    <div class="result-content" id="file-content"></div>
                </div>
            </div>

            <!-- AI检测功能 -->
            <div class="feature-card">
                <h3><span class="icon">🤖</span>AI智能检测</h3>
                <p>上传图像进行违章建筑检测，支持12种违章类型识别</p>
                
                <div class="upload-area" id="detectUploadArea">
                    <p>上传要检测的图像文件</p>
                    <input type="file" id="detectFileInput" class="file-input" accept="image/*" style="display:none;">
                    <button class="test-button" onclick="document.getElementById('detectFileInput').click()">选择图像</button>
                </div>
                
                <div style="margin: 10px 0;">
                    <label>置信度阈值: </label>
                    <input type="range" id="confidenceSlider" min="0.1" max="1.0" step="0.05" value="0.5" style="width: 150px;">
                    <span id="confidenceValue">0.5</span>
                </div>
                
                <button class="test-button" onclick="detectViolations()">开始检测</button>
                
                <div class="status" id="detect-status"></div>
                <div class="result-area" id="detect-result" style="display:none;">
                    <h4>检测结果:</h4>
                    <div class="result-content" id="detect-content"></div>
                </div>
            </div>

            <!-- API测试工具 -->
            <div class="feature-card">
                <h3><span class="icon">🔧</span>API测试工具</h3>
                <p>测试系统各个API接口的响应</p>
                
                <div style="margin: 15px 0;">
                    <select id="apiSelector" style="width: 100%; padding: 8px; border-radius: 4px;">
                        <option value="/health">GET /health - 健康检查</option>
                        <option value="/api/v1/system/health">GET /api/v1/system/health - 系统状态</option>
                        <option value="/api/v1/detection/model/info">GET /api/v1/detection/model/info - 模型信息</option>
                        <option value="/api/v1/files/stats">GET /api/v1/files/stats - 存储统计</option>
                        <option value="/api/v1/files/list">GET /api/v1/files/list - 文件列表</option>
                    </select>
                </div>
                
                <button class="test-button" onclick="testAPI()">测试API</button>
                <button class="test-button" onclick="openAPIDoc()">查看API文档</button>
                
                <div class="result-area" id="api-result" style="display:none;">
                    <h4>API响应:</h4>
                    <div class="result-content" id="api-content"></div>
                </div>
            </div>
        </div>

        <!-- 系统架构说明 -->
        <div class="feature-card">
            <h3><span class="icon">🏗️</span>系统架构概览</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 2rem;">🤖</div>
                    <strong>AI引擎</strong><br>
                    <small>YOLOv8模型<br>智能分类算法</small>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 2rem;">⚡</div>
                    <strong>API服务</strong><br>
                    <small>FastAPI框架<br>异步高性能</small>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 2rem;">💾</div>
                    <strong>数据存储</strong><br>
                    <small>PostgreSQL<br>Redis缓存</small>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="font-size: 2rem;">🐳</div>
                    <strong>容器化</strong><br>
                    <small>Docker部署<br>微服务架构</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        
        // 系统健康检查
        async function checkSystemHealth() {
            showResult('system', '正在检查系统状态...', 'loading');
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                showResult('system', JSON.stringify(data, null, 2), 'success');
            } catch (error) {
                showResult('system', `错误: ${error.message}`, 'error');
            }
        }

        // 获取模型信息
        async function getModelInfo() {
            showResult('system', '正在获取模型信息...', 'loading');
            try {
                const response = await fetch(`${API_BASE}/api/v1/detection/model/info`);
                const data = await response.json();
                showResult('system', JSON.stringify(data, null, 2), 'success');
            } catch (error) {
                showResult('system', `错误: ${error.message}`, 'error');
            }
        }

        // 获取文件统计
        async function getFileStats() {
            showResult('file', '正在获取存储统计...', 'loading');
            try {
                const response = await fetch(`${API_BASE}/api/v1/files/stats`);
                const data = await response.json();
                showResult('file', JSON.stringify(data, null, 2), 'success');
            } catch (error) {
                showResult('file', `错误: ${error.message}`, 'error');
            }
        }

        // 列出文件
        async function listFiles() {
            showResult('file', '正在获取文件列表...', 'loading');
            try {
                const response = await fetch(`${API_BASE}/api/v1/files/list?limit=10`);
                const data = await response.json();
                showResult('file', JSON.stringify(data, null, 2), 'success');
            } catch (error) {
                showResult('file', `错误: ${error.message}`, 'error');
            }
        }

        // 上传文件
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('upload', '请先选择文件', 'error');
                return;
            }

            showStatus('upload', '正在上传文件...', 'loading');
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch(`${API_BASE}/api/v1/files/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                showResult('file', JSON.stringify(data, null, 2), 'success');
                showStatus('upload', '文件上传成功!', 'success');
            } catch (error) {
                showResult('file', `错误: ${error.message}`, 'error');
                showStatus('upload', '文件上传失败', 'error');
            }
        }

        // 违章检测
        async function detectViolations() {
            const fileInput = document.getElementById('detectFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('detect', '请先选择图像文件', 'error');
                return;
            }

            const confidence = document.getElementById('confidenceSlider').value;
            showStatus('detect', '正在进行AI检测，请稍候...', 'loading');
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('confidence_threshold', confidence);
                
                const response = await fetch(`${API_BASE}/api/v1/detection/detect/image`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                showResult('detect', JSON.stringify(data, null, 2), 'success');
                
                if (data.success && data.result) {
                    const violations = data.result.total_violations;
                    showStatus('detect', `检测完成! 发现 ${violations} 个违章建筑`, 'success');
                } else {
                    showStatus('detect', '检测完成，未发现违章', 'success');
                }
            } catch (error) {
                showResult('detect', `错误: ${error.message}`, 'error');
                showStatus('detect', '检测失败', 'error');
            }
        }

        // API测试
        async function testAPI() {
            const selector = document.getElementById('apiSelector');
            const endpoint = selector.value;
            
            showResult('api', `正在测试 ${endpoint}...`, 'loading');
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();
                showResult('api', JSON.stringify(data, null, 2), 'success');
            } catch (error) {
                showResult('api', `错误: ${error.message}`, 'error');
            }
        }

        // 打开API文档
        function openAPIDoc() {
            window.open(`${API_BASE}/docs`, '_blank');
        }

        // 显示结果
        function showResult(section, content, type) {
            const resultArea = document.getElementById(`${section}-result`);
            const resultContent = document.getElementById(`${section}-content`);
            
            resultArea.style.display = 'block';
            resultContent.innerHTML = `<pre>${content}</pre>`;
            
            if (type === 'loading') {
                resultContent.style.borderLeftColor = '#3498db';
            } else if (type === 'success') {
                resultContent.style.borderLeftColor = '#2ecc71';
            } else if (type === 'error') {
                resultContent.style.borderLeftColor = '#e74c3c';
            }
        }

        // 显示状态
        function showStatus(section, message, type) {
            const status = document.getElementById(`${section}-status`);
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }

        // 置信度滑块更新
        document.getElementById('confidenceSlider').addEventListener('input', function() {
            document.getElementById('confidenceValue').textContent = this.value;
        });

        // 文件拖拽上传
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                showStatus('upload', `已选择文件: ${files[0].name}`, 'success');
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                showStatus('upload', `已选择文件: ${e.target.files[0].name}`, 'success');
            }
        });

        // 检测文件输入
        document.getElementById('detectFileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                showStatus('detect', `已选择图像: ${e.target.files[0].name}`, 'success');
            }
        });

        // 页面加载完成后自动检查系统状态
        window.addEventListener('load', () => {
            setTimeout(checkSystemHealth, 1000);
        });
    </script>
</body>
</html>